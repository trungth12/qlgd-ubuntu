var DATA=[{assignment_group_id:1,name:"BT1",weight:50,assignments:[{assignment_id:1,name:"BT11",points:10},{assignment_id:2,name:"BT12",points:8}]},{assignment_group_id:2,name:"BT2",weight:50,assignments:[{assignment_id:3,name:"BT21",points:9},{assignment_id:4,name:"BT22",points:8}]}],Assignments=React.createClass({displayName:"Assignments",getInitialState:function(){return{data:[],add:0}},loadData:function(){$.ajax({url:"/teacher/lop/"+this.props.lop+"/assignments.json",success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0})}.bind(this)})},componentWillMount:function(){this.loadData()},handleEdit:function(t){t._method="put",$.ajax({url:"/teacher//lop/"+this.props.lop+"/assignment_groups",type:"POST",data:t,success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0}),React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:this.props.lop}),document.getElementById("grades"))}.bind(this)})},handleUpdate:function(t){return t._method="put",$.ajax({url:"/teacher//lop/"+this.props.lop+"/assignments",type:"POST",data:t,success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0}),React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:this.props.lop}),document.getElementById("grades"))}.bind(this)}),!1},enableAdd:function(){this.state.add=1,this.forceUpdate()},cancelAdd:function(){this.state.add=0,this.forceUpdate()},onAdd:function(){var t=this.refs.name.getDOMNode().value,e=this.refs.weight.getDOMNode().value;if(e>0){var n={lop_id:this.props.lop_id,name:t,weight:e};$.ajax({url:"/teacher//lop/"+this.props.lop+"/assignment_groups",type:"POST",data:n,success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0}),React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:this.props.lop}),document.getElementById("grades"))}.bind(this)})}else alert("Trọng số phải lớn hơn 0");return!1},handleDelete:function(t){var e={assignment_group_id:t.assignment_group_id,_method:"delete"};$.ajax({url:"/teacher//lop/"+this.props.lop+"/assignment_groups",type:"POST",data:e,success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0}),React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:this.props.lop}),document.getElementById("grades"))}.bind(this)})},handleAssignmentDelete:function(t){var e={assignment_id:t.assignment_id,_method:"delete"};$.ajax({url:"/teacher//lop/"+this.props.lop+"/assignments",type:"POST",data:e,success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0}),React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:this.props.lop}),document.getElementById("grades"))}.bind(this)})},handleAssignmentAdd:function(t){var e={assignment_group_id:t.assignment_group_id,name:t.name,points:t.points};return $.ajax({url:"/teacher//lop/"+this.props.lop+"/assignments",type:"POST",data:e,success:function(t){t.forEach(function(t){null!=t.assignments&&t.assignments.length>0&&t.assignments.map(function(t){return t.edit=0,t})}),this.setState({data:t,add:0}),React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:this.props.lop}),document.getElementById("grades"))}.bind(this)}),!1},componentDidUpdate:function(){var t=this,e=document.getElementById("multi");[].forEach.call(e.getElementsByClassName("tile__list"),function(e){new Sortable(e,{group:"photo"+e.id,onUpdate:function(e){var n=$("#"+e.item.id).data("group"),a=$("#"+e.item.id).data("assignment"),s=$("li.group"+n).index(e.item),i={assignment_group_id:n,assignment_id:a,position:s};$.ajax({url:"/teacher//lop/"+t.props.lop+"/reorder_assignments",type:"POST",data:i,success:function(){React.unmountAndReleaseReactRootNode(document.getElementById("grades")),React.renderComponent(Grade({lop:t.props.lop}),document.getElementById("grades"))}.bind(t)})}})})},render:function(){var t=this,e=this.state.data.map(function(e){return AssignmentGroup({key:"assignment_group"+e.assignment_group_id,onAssignmentDelete:t.handleAssignmentDelete,onDelete:t.handleDelete,onEdit:t.handleEdit,weight:e.weight,group_name:e.name,onUpdate:t.handleUpdate,group:e.assignment_group_id,can_destroy:e.can_destroy,data:e.assignments,onAddAssignment:t.handleAssignmentAdd})});return 0===this.state.add?React.DOM.div(null,React.DOM.hr(null),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.enableAdd},"Thêm"),React.DOM.hr(null),React.DOM.ul({id:"multi"},e)):React.DOM.div(null,React.DOM.hr(null),React.DOM.input({ref:"name",type:"text",placeholder:"Tên nhóm điểm"}),React.DOM.input({ref:"weight",type:"text",placeholder:"Trọng số"}),React.DOM.div({className:"btn-group btn-group-sm"},React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.cancelAdd},"Hủy"),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.onAdd},"Cập nhật")),React.DOM.hr(null),React.DOM.ul({id:"multi"},e))}}),AssignmentGroup=React.createClass({displayName:"AssignmentGroup",getInitialState:function(){return{add:0,edit:0}},handleClick:function(){this.setState({add:1,edit:0})},handleCancel:function(){this.setState({add:0,edit:0})},handleAdd:function(){var t=this.refs.name.getDOMNode().value,e=this.refs.points.getDOMNode().value;this.setState({add:0,edit:0}),this.props.onAddAssignment({assignment_group_id:this.props.group,name:t,points:e})},cancelUpdateName:function(){this.setState({edit:0,add:0})},handleUpdateName:function(){this.setState({add:0,edit:1})},handleEdit:function(){var t=this.refs.name.getDOMNode().value,e=this.refs.weight.getDOMNode().value;this.setState({edit:0,add:0}),this.props.onEdit({assignment_group_id:this.props.group,name:t,weight:e})},handleDelete:function(){confirm("Đồng ý")&&this.props.onDelete({assignment_group_id:this.props.group})},componentDidUpdate:function(){1==this.state.edit&&(this.refs.name.getDOMNode().value=this.props.group_name,this.refs.weight.getDOMNode().value=this.props.weight)},render:function(){var t=this,e=React.DOM.li(null);return null!=this.props.data&&(e=this.props.data.map(function(e){return Assignment({group:t.props.group,key:"assignment"+e.assignment_id,data:e,onUpdate:t.props.onUpdate,onDelete:t.props.onAssignmentDelete})})),0===this.state.add?0===this.state.edit?React.DOM.li({id:"group"+this.props.group,"data-type":"assignment_group","data-group":this.props.group,className:"layer tile"},React.DOM.div({className:"row"},React.DOM.div({className:"col-sm-3",className:"tile__name"},this.props.group_name),React.DOM.div({style:{"font-weight":"bold"},className:"col-sm-3",onClick:this.handleWeight},this.props.weight," %"),React.DOM.button({onClick:this.handleUpdateName,className:"btn btn-sm btn-success"},"Sửa"),React.DOM.button({style:{display:this.props.can_destroy===!1?"none":""},className:"btn btn-danger btn-sm glow",onClick:this.handleDelete},"Xóa"),React.DOM.span(null,"                 "),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleClick},"Thêm đầu điểm"),React.DOM.ul({id:"group"+this.props.group,"data-group":this.props.group,className:"tile__list"},e))):React.DOM.li(null,React.DOM.div(null,React.DOM.input({ref:"name",type:"text",id:"group"+this.props.group,placeholder:"Tên nhóm điểm"}),React.DOM.input({ref:"weight",type:"text",id:"weight"+this.props.group,placeholder:"Trọng số"}),React.DOM.div({className:"btn-group btn-group-sm"},React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.cancelUpdateName},"Hủy"),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleEdit},"Cập nhật"))),React.DOM.div(null,React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleClick},"Thêm đầu điểm"),React.DOM.ul(null,e))):0===this.state.edit?React.DOM.li(null,React.DOM.span({className:"tile__name"},this.props.group_name),React.DOM.span(null,this.props.weight),React.DOM.button({onClick:this.handleUpdateName,className:"btn btn-sm btn-success"},"Sửa"),React.DOM.button({style:{display:this.props.can_destroy===!1?"none":""},className:"btn btn-danger btn-sm glow",onClick:this.handleDelete},"Xóa"),React.DOM.div(null,React.DOM.input({ref:"name",type:"text",placeholder:"Tên đầu điểm"}),React.DOM.input({ref:"points",type:"text",placeholder:"Điểm tối đa"}),React.DOM.div({className:"btn-group btn-group-sm"},React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleCancel},"Hủy"),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleAdd},"Cập nhật")),React.DOM.ul(null,e))):React.DOM.li(null,React.DOM.div(null,React.DOM.input({ref:"name",type:"text",id:"group"+this.props.group,placeholder:"Tên nhóm điểm"}),React.DOM.input({ref:"weight",type:"text",id:"weight"+this.props.group,placeholder:"Trọng số"}),React.DOM.div({className:"btn-group btn-group-sm"},React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.cancelUpdateName},"Hủy"),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleEdit},"Cập nhật"))),React.DOM.div(null,React.DOM.input({ref:"name",type:"text",placeholder:"Tên đầu điểm"}),React.DOM.input({ref:"points",type:"text",placeholder:"Điểm tối đa"}),React.DOM.div({className:"btn-group btn-group-sm"},React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleCancel},"Hủy"),React.DOM.button({className:"btn btn-primary btn-sm glow",onClick:this.handleAdd},"Cập nhật")),React.DOM.ul(null,e)))}}),Assignment=React.createClass({displayName:"Assignment",getInitialState:function(){return{edit:0}},handleEdit:function(){this.setState({edit:1})},handleCancelEdit:function(){this.setState({edit:0})},handleUpdate:function(){if(1===this.state.edit){var t=this.refs.mname.getDOMNode().value,e=this.refs.mpoints.getDOMNode().value,n={assignment_group_id:this.props.group,assignment_id:this.props.data.assignment_id,name:t,points:e};this.setState({edit:0}),this.props.onUpdate(n)}},handleDelete:function(){confirm("Đồng ý")&&this.props.onDelete({assignment_id:this.props.data.assignment_id})},componentDidUpdate:function(){$("#mname"+this.props.data.assignment_id).val(this.props.data.name),$("#mpoints"+this.props.data.assignment_id).val(this.props.data.points),this.props.data.can_destroy===!1&&$("#btndelete"+this.props.data.assignment_id).hide()},render:function(){return 1===this.state.edit?React.DOM.li(null,React.DOM.input({id:"mname"+this.props.data.assignment_id,ref:"mname",type:"text"}),React.DOM.input({id:"mpoints"+this.props.data.assignment_id,ref:"mpoints",type:"text"}),React.DOM.input({className:"btn btn-primary btn-sm",onClick:this.handleCancelEdit,type:"submit",value:"Hủy"}),React.DOM.input({className:"btn btn-primary btn-sm",onClick:this.handleUpdate,type:"submit",value:"Cập nhật"})):React.DOM.li({"data-type":"assignment","data-assignment":this.props.data.assignment_id,"data-group":this.props.group,id:"item"+this.props.data.assignment_id,className:"group"+this.props.group},React.DOM.div(null,React.DOM.span(null,this.props.data.name),React.DOM.span(null,", điểm tối đa: ",this.props.data.points),React.DOM.span(null,React.DOM.button({onClick:this.handleEdit,className:"btn btn-sm btn-success"},"Sửa"),React.DOM.button({style:{display:this.props.data.can_destroy===!1?"none":""},className:"btn btn-danger btn-sm glow",onClick:this.handleDelete},"Xóa"))))}});